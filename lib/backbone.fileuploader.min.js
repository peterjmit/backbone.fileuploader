/*!
 * backbone.fileuploader.js v0.0.1
 * Copyright 2013, Peter Mitchell (@peterjmit)
 * backbone.fileuploader.js may be distributed under the MIT licence
 */
(function(e){"use strict";var t=e.Backbone,i=e._;e.$;var a=t.View.extend({constructor:function a(e){e=e||{},t.View.call(this,e),this.setupFileUploader()},setupFileUploader:function(){this.events=this.events||{},this.options.dragAndDrop&&(this.events.dragover="onDrag",this.events.drop="onDrop"),this.events["change input[type=file]"]="onFormChange",this.options.paste&&(this.events.paste="onPaste")},onFormChange:function(e){e.stopPropagation(),e.preventDefault(),this.addFiles(e.target.files)},onDrag:function(e){e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy"},onDrop:function(e){e.stopPropagation(),e.preventDefault(),this.addFiles(e.originalEvent.dataTransfer.files)},onPaste:function(e){var t=[],a=e.originalEvent.clipboardData;e.stopPropagation(),e.preventDefault(),i.each(a.types,function(e,i){"Files"===e&&t.push(a.items[i].getAsFile())},this),this.addFiles(t)},addFiles:function(e){i.each(e,this.handleFile,this)},handleFile:function(e){var t=new FileReader;t.onload=i.bind(this.onFileLoad,this,e),t.readAsDataURL(e)},onFileLoad:function(e,t){this.trigger("filesready",{name:e.name,mimeType:e.type,lastModified:e.lastModifiedDate,size:e.size,data:t.target.result,isImage:!!e.type.match("image.*")})}});a.prototype.options={dragAndDrop:!0,paste:!1,insertFileElement:!0,template:i.template('<div class="drop-area"></div><input type="file" name="files[]" multiple />')},t.FileUploader=a})("object"==typeof global?global:this);
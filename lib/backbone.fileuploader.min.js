/*!
 * backbone.fileuploader v0.0.1
 * Copyright 2013, Peter Mitchell (@peterjmit)
 * backbone.fileuploader may be distributed under the MIT licence
 */
(function(e){"use strict";var t=e.Backbone,a=e._;e.$;var i=t.View.extend({constructor:function i(e){e=a.defaults(e||{},{dragAndDrop:!0,paste:!1}),this.events=this.events||{},e.dragAndDrop&&(this.events.dragover="onDrag",this.events.drop="onDrop"),this.events["change input"]="onFormChange",e.paste&&(this.events.paste="onPaste"),t.View.call(this,e)},onFormChange:function(e){e.stopPropagation(),e.preventDefault(),this.addFiles(e.target.files)},onDrag:function(e){e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy"},onDrop:function(e){e.stopPropagation(),e.preventDefault(),this.addFiles(e.originalEvent.dataTransfer.files)},onPaste:function(e){var t=[],i=e.originalEvent.clipboardData;e.stopPropagation(),e.preventDefault(),a.each(i.types,function(e,a){"Files"===e&&t.push(i.items[a].getAsFile())},this),this.addFiles(t)},addFiles:function(e){a.each(e,this.handleFile,this)},handleFile:function(e){var t=new FileReader;t.onload=a.bind(this.onFileLoad,this,e),t.readAsDataURL(e)},onFileLoad:function(e,t){this.trigger("filesready",{name:e.name,mimeType:e.type,lastModified:e.lastModifiedDate,size:e.size,data:t.target.result,isImage:!!e.type.match("image.*")})}});t.FileUploader=i})("object"==typeof global?global:this);